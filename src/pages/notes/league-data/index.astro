---
import Layout from '../../../layouts/layout.astro';
import { Info, Note, Title, P, H2, A, Details } from '../../../components';
import MatchesHeatmap from './MatchesHeatmap.astro';
import MatchesBar from './MatchesBar.astro';
import MatchesDayOfWeek from './MatchesDayOfWeek.astro';
import MatchesHeatmapMe from './MatchesHeatmapMe.astro';
import MatchesPerPlayer from './MatchesPerPlayer.astro';
import MatchesTimeOfDay from './MatchesTimeOfDay.astro';
import GoalsVsMatches from './GoalsVsMatches.astro';
import MatchesVsGoalsPerMatch from './MatchesVsGoalsPerMatch.astro';
import OffensiveGoalRate from './OffensiveGoalRate.astro';
import WinStreakMe from './WinStreakMe.astro';
import PlayerInvolvement from './PlayerInvolvement.astro';
import PlayerInvolvementWins from './PlayerInvolvementWins.astro';
import { notes } from '../../notes';

const info = notes['league-data'];
---

<Layout>
	<Note>
		<Title subtitle={info.subtitle}>
			{info.title}
		</Title>
		<Info>Work in progress</Info>
		<P>
			About 4 years ago I graduated from university and started my first job at a company. Some two
			weeks into my employment I was asked to join a game of foosball (also known as table soccer or <em
				>t√∂ggele</em
			> if you care for some swiss german) by some colleagues. It was fun!
		</P>
		<P>
			Anyway, so my career took off, I enjoyed the craft very much and developed some solid skills.
			I'd even say I made one or the other valuable contribution to the people around me and their
			success. Today, I can proudly call myself Senior
			<s>Foosball Player</s>
			<em>*cough*</em> Software Engineer.
		</P>
		<P>
			All jokes aside, I did spend most of my time writing software (sitting in meetings) and far
			too little playing foosball. Luckily a colleague built a web app that has been used to
			meticulously track every match played at work, so I <em>could</em> give you the exact time I spent
			playing foosball. But I won't without a lawyer in the room. Thinking about this now, you'd assume
			someone going through the trouble of building an app where people willingly record their slacking
			off would be out to blackmail you later. I'm reasonably certain that's not the case. Especially
			because the author is also the most prolific player.
		</P>
		<H2>Data</H2>
		<P>
			So this is the deal: For the past nine years employees of my company have played foosball and
			tracked every match. The data includes timestamps of the start and end of every match, who
			played, in what constellation and who scored goals. The app also implements a ranking based on
			an <A href="https://en.wikipedia.org/wiki/Elo_rating_system">Elo rating system</A>. A typical
			pilgrimage to the foosball table would include 4 matches to 5 goals each. The players are
			arranged in a specific way and permutated between matches. For instance, among 4 players and 4
			matches, everyone needs to play with someone twice. The app would ensure that the top and
			bottom rated players play together twice to even out the playing field.
		</P>
		<P>
			Naturally, this treasure trove of company time embezzelment deserves a thorough look. First I
			want to run some analysis on the data and produce some nice visualizations. That's the note
			you're looking at right now. In a follow-up, I will compare different ranking algorithms and
			hopefully improve on the current implementation. Lastly, the goal is to implement V2 of this
			app as the old one is showing its age.
		</P>
		<Details title="How are these plots generated?">
			<P>
				I'm using an excellent JS library called
				<A href="https://observablehq.com/plot/">Observable Plot</A>. It's highly configurable but
				still fairly ergonomic to use. In fact, the library is written by the same author as D3,
				<em>the</em> data viz library.
			</P>
			<P>
				The plots are generated statically at build-time and shipped as SVGs in the HTML. Very happy
				with this setup and I highly recommend to try Plot!
			</P>
		</Details>
		<H2>Match distributions</H2>
		<MatchesHeatmap />
		<MatchesBar />
		<MatchesDayOfWeek />
		<MatchesHeatmapMe />
		<MatchesPerPlayer />
		<MatchesTimeOfDay />
		<GoalsVsMatches />
		<MatchesVsGoalsPerMatch />
		<OffensiveGoalRate />
		<WinStreakMe />
		<PlayerInvolvement />
		<PlayerInvolvementWins />
		<H2>What's next?</H2>
		<P>
			There are of course many more interesting visualizations left untouched here. If you have a
			great idea make sure to let me know in the feedback box on the bottom right of the page.
		</P>
		<P>
			The thing we're really interested in however, is who's the best. After all, at least half the
			enjoyment (according to me) of a competitive activity is being able to tell others they suck
			if you win. But how do we know who is the best? A simple measure like the ratio of wins to
			matches played has shortcomings. Luckily this is a well established problem with intersting
			solutions. In a follow up note we will compare different ranking algorithms by their ability
			to predict the outcome of future matches.
		</P>
	</Note>
</Layout>
